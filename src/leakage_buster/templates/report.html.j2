
<!doctype html><html lang="zh"><meta charset="utf-8"/>
<title>Leakage Buster æŠ¥å‘Š</title>
<style>
  body{font-family:system-ui,Segoe UI,Arial,PingFang SC; margin:24px}
  .risk{border:1px solid #ddd; border-radius:8px; padding:12px 16px; margin:12px 0}
  .sev-high{border-left:6px solid #d9534f}.sev-medium{border-left:6px solid #f0ad4e}.sev-low{border-left:6px solid #5bc0de}
  code,pre{background:#f8f8f8; padding:2px 4px; border-radius:4px}
  .summary{background:#f9f9f9; border:1px solid #ddd; border-radius:8px; padding:16px; margin:16px 0}
  .fix-card{background:#e8f5e8; border:1px solid #c3e6c3; border-radius:8px; padding:12px; margin:8px 0}
  .fix-high{background:#fdf2f2; border-color:#f5c6cb}
  .fix-medium{background:#fff3cd; border-color:#ffeaa7}
  .fix-low{background:#d1ecf1; border-color:#bee5eb}
  .preview-section{background:#f0f8ff; border:2px dashed #4a90e2; border-radius:8px; padding:16px; margin:16px 0}
  ul{margin:8px 0; padding-left:20px}
</style>
<h1>Leakage Buster æŠ¥å‘Š</h1>
<div>å‘½ä»¤å‚æ•°ï¼š<code>{{ meta["args"] }}</code></div>
<div>ç›®æ ‡åˆ—ï¼š<code>{{ meta["target"] }}</code>ï¼›æ—¶é—´åˆ—ï¼š<code>{{ meta["time_col"] or "æœªæŒ‡å®š" }}</code>ï¼›CVç­–ç•¥ï¼š<code>{{ meta["cv_type"] or "æœªæŒ‡å®š" }}</code></div>
<div>æ ·æœ¬æ•°ï¼š{{ meta["n_rows"] }}ï¼›ç‰¹å¾æ•°ï¼š{{ meta["n_cols"] }}</div>

<!-- ä¿®å¤å»ºè®®æ‘˜è¦å¡ç‰‡åŒºåŸŸ -->
{% if results["risks"] %}
<div class="summary">
  <h2>ğŸ”§ ä¿®å¤å»ºè®®æ‘˜è¦</h2>
  {% set high_risks = results["risks"] | selectattr("severity", "equalto", "high") | list %}
  {% set medium_risks = results["risks"] | selectattr("severity", "equalto", "medium") | list %}
  {% set low_risks = results["risks"] | selectattr("severity", "equalto", "low") | list %}
  
  {% if high_risks %}
  <div class="fix-card fix-high">
    <h4>ğŸš¨ é«˜å±é—®é¢˜ï¼ˆ{{ high_risks|length }}ä¸ªï¼‰</h4>
    <ul>
    {% for r in high_risks %}
      <li><strong>{{ r["name"] }}</strong>
        {% if r["name"].startswith("Target leakage") %}
          - ç«‹å³åˆ é™¤æˆ–åœ¨CVå†…é‡ç®—ç›¸å…³åˆ—
        {% elif r["name"].startswith("Target encoding") %}
          - æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†å…¨é‡ç›®æ ‡ç¼–ç ï¼Œæ”¹ä¸ºCVå†…ç¼–ç 
        {% elif r["name"].startswith("Time window") %}
          - ç¡®ä¿ç»Ÿè®¡ç‰¹å¾ä»…ä½¿ç”¨çª—å£å†…æ•°æ®
        {% elif r["name"].startswith("CV strategy") %}
          - è°ƒæ•´CVç­–ç•¥ä»¥åŒ¹é…æ•°æ®ç‰¹å¾
        {% endif %}
      </li>
    {% endfor %}
    </ul>
  </div>
  {% endif %}
  
  {% if medium_risks %}
  <div class="fix-card fix-medium">
    <h4>âš ï¸ ä¸­å±é—®é¢˜ï¼ˆ{{ medium_risks|length }}ä¸ªï¼‰</h4>
    <ul>
    {% for r in medium_risks %}
      <li><strong>{{ r["name"] }}</strong>
        {% if r["name"].startswith("KFold leakage") %}
          - è€ƒè™‘ä½¿ç”¨GroupKFoldé¿å…ç»„é—´æ³„æ¼
        {% elif r["name"].startswith("Target leakage (categorical") %}
          - æ£€æŸ¥ç±»åˆ«ç‰¹å¾æ˜¯å¦ç”±ç›®æ ‡èšåˆäº§ç”Ÿ
        {% elif r["name"].startswith("Statistical leakage") %}
          - ç¡®è®¤ç»Ÿè®¡ç‰¹å¾åœ¨CVå†…æ­£ç¡®è®¡ç®—
        {% endif %}
      </li>
    {% endfor %}
    </ul>
  </div>
  {% endif %}
  
  {% if low_risks %}
  <div class="fix-card fix-low">
    <h4>ğŸ’¡ å»ºè®®ä¼˜åŒ–ï¼ˆ{{ low_risks|length }}ä¸ªï¼‰</h4>
    <ul>
    {% for r in low_risks %}
      <li><strong>{{ r["name"] }}</strong>
        {% if r["name"].startswith("Time-awareness") %}
          - ä½¿ç”¨æ—¶é—´æ„ŸçŸ¥çš„ç‰¹å¾å·¥ç¨‹å’ŒéªŒè¯ç­–ç•¥
        {% elif r["name"].startswith("CV strategy recommendation") %}
          - è€ƒè™‘é‡‡ç”¨æ¨èçš„CVç­–ç•¥
        {% endif %}
      </li>
    {% endfor %}
    </ul>
  </div>
  {% endif %}
  
  <p><strong>è¯¦ç»†ä¿®å¤ä»£ç è§ï¼š</strong> <code>fix_transforms.py</code></p>
</div>
{% endif %}

<hr/>

<!-- ç»Ÿè®¡ç±»æ³„æ¼ï¼ˆé¢„è§ˆï¼‰åˆ†åŒº -->
<div class="preview-section">
  <h2>ğŸ“Š ç»Ÿè®¡ç±»æ³„æ¼ï¼ˆé¢„è§ˆï¼‰</h2>
  <p><em>æ­¤åŠŸèƒ½ä¸ºé¢„è§ˆç‰ˆï¼Œç”¨äºæ£€æµ‹ç–‘ä¼¼ç»Ÿè®¡ç‰¹å¾æ³„æ¼ã€‚å…·ä½“å®ç°å°†åœ¨åç»­ç‰ˆæœ¬ä¸­å®Œå–„ã€‚</em></p>
  
  {% set stat_risks = results["risks"] | selectattr("name", "equalto", "Statistical leakage (preview)") | list %}
  {% if stat_risks %}
    <div class="risk sev-medium">
      <h3>ç»Ÿè®¡ç‰¹å¾æ£€æµ‹ç»“æœ</h3>
      {% for r in stat_risks %}
        <p>{{ r["detail"] }}</p>
        <pre>{{ r["evidence"] | tojson(indent=2) }}</pre>
      {% endfor %}
    </div>
  {% else %}
    <p>âœ… æœªæ£€æµ‹åˆ°æ˜æ˜¾çš„ç»Ÿè®¡ç‰¹å¾æ³„æ¼ã€‚</p>
  {% endif %}
  
  <div style="margin-top: 12px; padding: 8px; background: #fff3cd; border-radius: 4px;">
    <strong>æ³¨æ„ï¼š</strong>æ­¤é¢„è§ˆåŠŸèƒ½ä¸»è¦æ£€æµ‹å˜å¼‚ç³»æ•°è¾ƒå°çš„æ•°å€¼ç‰¹å¾ï¼Œè¿™äº›ç‰¹å¾å¯èƒ½æ˜¯èšåˆç»Ÿè®¡ç»“æœã€‚
    å»ºè®®åœ¨ç‰¹å¾å·¥ç¨‹æ—¶ç¡®ä¿æ‰€æœ‰ç»Ÿè®¡ç‰¹å¾éƒ½åœ¨äº¤å‰éªŒè¯çš„æŠ˜å å†…æ­£ç¡®è®¡ç®—ã€‚
  </div>
</div>

<hr/>

<!-- è¯¦ç»†é£é™©é¡¹ -->
<h2>ğŸ“‹ è¯¦ç»†æ£€æµ‹ç»“æœ</h2>
{% if results["risks"] %}
  {% for r in results["risks"] %}
    <div class="risk sev-{{ 'high' if r['severity']=='high' else 'medium' if r['severity']=='medium' else 'low' }}">
      <h3>{{ r["name"] }}ï¼ˆ{{ r["severity"] }}ï¼‰</h3>
      <p>{{ r["detail"] }}</p>
      <pre>{{ r["evidence"] | tojson(indent=2) }}</pre>
    </div>
  {% endfor %}
{% else %}
  <p>âœ… æœªå‘ç°æ˜æ˜¾é£é™©é¡¹ã€‚</p>
{% endif %}

<hr/>
<p><em>æŠ¥å‘Šç”Ÿæˆæ—¶é—´ï¼š{{ now }}</em></p>
</html>

